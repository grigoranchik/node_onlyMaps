<!DOCTYPE html>
<html ng-app="myApp">
<head>

    <title>Quick Start - Leaflet</title>

    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>
    <script src="http://ajax.googleapis.com/ajax/libs/angularjs/1.4.2/angular.min.js"></script>
    <link rel="shortcut icon" type="image/x-icon" href="docs/images/favicon.ico" />
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.3.1/dist/leaflet.css" integrity="sha512-Rksm5RenBEKSKFjgI3a41vrjkw4EVPlJ3+OiI65vTjIdo9brlAacEuKOiQ5OFh7cOI1bkDwLqdLw3Zg0cRJAAQ==" crossorigin=""/>
    <script src="https://unpkg.com/leaflet@1.3.1/dist/leaflet.js" integrity="sha512-/Nsx9X4HebavoBvEBuyp3I7od5tA0UzAxs+j83KgC8PU0kgB4XiK4Lfe4y4cgBtaRJQEIFCW+oC506aPT2L1zw==" crossorigin=""></script>
    <script src="http://cdn.leafletjs.com/leaflet-0.7.3/leaflet.js"></script>
    <link rel="stylesheet" href="http://cdn.leafletjs.com/leaflet-0.7.3/leaflet.css"/>
    <script src="/users/static/AnimatedMarker.js"></script>

    <script>
        var MY_TOTAL_APP = angular.module("myApp", []);

        MY_TOTAL_APP.controller('myLittleController', ['$scope', '$timeout', '$http', '$q', '$rootScope',

            function ($scope, $timeout, $http, $q, $rootScope) {
                var vm = this;
                vm.textareaModel='';

                $rootScope.$on('myCustomEvent', function (event, value) {
                    vm.textareaModel = value.someProp;
                });

                vm.look = function(){
                    console.info('vm.textareaModel= ' + JSON.stringify(vm.textareaModel, null, 2));
                }

                vm.isTotalLoadedAndShown=false;
                vm.isTotalLoadedAndShownFunc = function (varChange) {
                    if(varChange == false){
                        vm.isTotalLoadedAndShown = true;
                    }else{
                        vm.isTotalLoadedAndShown = false;
                    }
                }
                vm.downloadFunc = function () {
                    var promise = $http.get('/users/static/myJson.JSON');
                    promise.then(function (response) {
                        debugger;
                        vm.textareaModel='';
                        vm.textareaModel = response.data;

                    });
                }

                vm.saveFunc = function(){
                    data = {myJson: vm.textareaModel}
                    debugger;
                    var promise = $http.post('/users/static/send_json', data , {
                        headers: {'Content-Type': 'application/json'}
                    });
                    promise.then(function (e){
                        console.log(e.status);
                    }).catch(function(error) {
                        console.log(error.status);
                    });

                }

                vm.clearFunc = function(){
                    vm.textareaModel='';
                }
            }
        ]);

        MY_TOTAL_APP.directive('lookDirective', ['$rootScope', function ($rootScope) {
            return {
                scope: {
                    info: "=lookDirective"
                },
                link: function (scope, element, attr) {
                    //debugger;
                    var extendeElem = $(element);
                    var info = scope.info;

                    extendeElem.on('DOMSubtreeModified',function(){
                        $rootScope.$emit('myCustomEvent', {
                            someProp: JSON.parse(extendeElem.text())
                        });
                    });
                }
            }
        }]);

    </script>

</head>
<body>

    <div id="mapid" style="width: 600px; height: 400px;"></div>
    <hr/>
    <div ng-controller="myLittleController as myCtrl">
        <div placeholder="Remember, be nice!" look-directive="myCtrl.textareaModel" style="width:300px; height:80px;" id="sendJSON" hidden></div>
        <button ng-click="myCtrl.look()">look</button>
        <button ng-click="myCtrl.downloadFunc()">download json</button>
        <button ng-click="myCtrl.saveFunc()">save json</button>
    </div>



    <script src="/users/static/bliadariym.js"></script>

</body>
</html>
